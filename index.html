<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ù…ÙŠÙ…ÙˆØ±ÙŠ Ù…Ø§ØªØ´ Ø±Ù…Ø¶Ø§Ù†ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Naskh Arabic', serif;
            background-color: #0a1f3c;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Islamic Pattern Background */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23ffffff' fill-opacity='0.05' d='M96.5,40.5c-0.5-1-2.5-2-2.5-2s1.5-2,1.5-3s-1.5-2-1.5-2s1-1.5,0.5-2.5s-2-1-2-1s0.5-2-0.5-2.5s-2,0-2,0s0-2-1-2.5 s-2,0.5-2,0.5s-0.5-2-1.5-2s-1.5,1-1.5,1s-1-1.5-2-1.5s-1.5,1.5-1.5,1.5s-1.5-1-2.5-0.5s-1,2-1,2s-2-0.5-2.5,0.5s0,2,0,2s-2,0.5-2.5,1.5 s0.5,2,0.5,2s-1.5,1-2,2s0.5,2,0.5,2s-2,1.5-2,2.5s1,1.5,1,1.5s-1.5,2-1,3s2,1,2,1s-1,2-0.5,2.5s2,0.5,2,0.5s-0.5,2,0.5,2.5s2-0.5,2-0.5 s0,2,1,2.5s2-0.5,2-0.5s0.5,2,1.5,2s1.5-1,1.5-1s1,1.5,2,1.5s1.5-1.5,1.5-1.5s1.5,1,2.5,0.5s1-2,1-2s2,0.5,2.5-0.5s0-2,0-2s2-0.5,2.5-1.5 s-0.5-2-0.5-2s1.5-1,2-2s-0.5-2-0.5-2s2-1.5,2-2.5S96.5,40.5,96.5,40.5z'/%3E%3C/svg%3E");
            opacity: 0.1;
            z-index: -1;
        }

        .container {
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        .header {
            margin-bottom: 20px;
        }

        h1 {
            color: #ffffff;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .ramadan-icon {
            font-size: 2rem;
            margin: 0 5px;
        }

        .level-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .level-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            margin: 0 5px;
            transition: all 0.3s ease;
        }

        .level-dot.active {
            background-color: #ffffff;
            transform: scale(1.2);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .info-label {
            font-size: 1rem;
            margin-bottom: 5px;
            color: #ffffff;
            opacity: 0.8;
        }

        .info-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }

        .memory-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-gap: 10px;
            margin-bottom: 20px;
        }

        .card {
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            perspective: 1000px;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .card-front {
            background-color: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 2rem;
        }

        .card-back {
            background-color: rgba(255, 255, 255, 0.05);
            transform: rotateY(180deg);
            font-size: 2.5rem;
        }

        .card:hover {
            transform: scale(1.03);
            border-color: #ffffff;
        }

        .status {
            font-size: 1.5rem;
            margin-bottom: 20px;
            height: 30px;
            color: #ffffff;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        button {
            background-color: #1e3a8a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Naskh Arabic', serif;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        button:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #ffffff;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
        }

        /* Lantern Animation */
        .lantern {
            position: absolute;
            top: -50px;
            font-size: 3rem;
            animation: swing 3s infinite ease-in-out;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .lantern:nth-child(1) {
            left: 10%;
            animation-delay: 0s;
        }

        .lantern:nth-child(2) {
            left: 90%;
            animation-delay: 0.5s;
        }

        @keyframes swing {
            0%, 100% {
                transform: translateY(0) rotate(5deg);
            }
            50% {
                transform: translateY(10px) rotate(-5deg);
            }
        }

        /* Level Complete Animation */
        @keyframes celebrate {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        .celebrate {
            animation: celebrate 0.5s ease-in-out;
        }

        .level-complete {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(10, 31, 60, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            padding: 20px;
        }

        .level-complete.show {
            opacity: 1;
            pointer-events: auto;
        }

        .level-complete h2 {
            font-size: 3rem;
            color: #ffffff;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .level-complete p {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
        }

        .level-complete button {
            font-size: 1.2rem;
            padding: 15px 30px;
        }

        .matched {
            opacity: 0.6;
            cursor: default;
        }

        .progress-container {
            width: 100%;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #2563eb;
            width: 0%;
            transition: width 0.3s ease;
        }

        .game-start {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(10, 31, 60, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .game-start h2 {
            font-size: 2.5rem;
            color: #ffffff;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .game-start p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
            max-width: 600px;
            text-align: center;
            line-height: 1.6;
        }

        .game-start button {
            font-size: 1.2rem;
            padding: 15px 30px;
            background-color: #2563eb;
        }

        .game-complete {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(10, 31, 60, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            padding: 20px;
        }

        .game-complete.show {
            opacity: 1;
            pointer-events: auto;
        }

        .game-complete h2 {
            font-size: 3rem;
            color: #ffffff;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .game-complete p {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
            text-align: center;
        }

        .game-complete button {
            font-size: 1.2rem;
            padding: 15px 30px;
            background-color: #2563eb;
        }

        .level-badge {
            display: inline-block;
            background-color: #2563eb;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 0 5px;
        }

        /* Buttons container for game start */
        .start-buttons {
            display: flex;
            gap: 15px;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .memory-board {
                grid-template-columns: repeat(4, 1fr);
                grid-gap: 8px;
            }
            
            .card {
                height: 90px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .level-complete h2, .game-complete h2 {
                font-size: 2.5rem;
            }
            
            .level-complete p, .game-complete p {
                font-size: 1.3rem;
            }
            
            .start-buttons {
                flex-direction: column;
            }
        }

        @media (max-width: 600px) {
            .memory-board {
                grid-template-columns: repeat(3, 1fr);
                grid-gap: 6px;
            }
            
            .card {
                height: 80px;
                font-size: 2rem;
            }
            
            .card-front {
                font-size: 1.8rem;
            }
            
            .card-back {
                font-size: 2.2rem;
            }

            h1 {
                font-size: 1.8rem;
            }
            
            .game-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .info-item {
                flex-direction: row;
                justify-content: space-between;
                width: 100%;
            }
            
            .status {
                font-size: 1.2rem;
                height: auto;
                min-height: 30px;
            }
            
            .level-complete h2, .game-complete h2, .game-start h2 {
                font-size: 2rem;
            }
            
            .level-complete p, .game-complete p, .game-start p {
                font-size: 1.1rem;
            }
            
            button {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .level-complete button, .game-complete button, .game-start button {
                font-size: 1rem;
                padding: 12px 24px;
            }
        }

        @media (max-width: 400px) {
            .memory-board {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .card {
                height: 70px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .ramadan-icon {
                font-size: 1.5rem;
            }
            
            .info-value {
                font-size: 1.2rem;
            }
            
            .info-label {
                font-size: 0.9rem;
            }
            
            .level-dot {
                width: 12px;
                height: 12px;
            }
        }

        /* Landscape mode for mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .container {
                padding-top: 10px;
            }
            
            .header {
                margin-bottom: 10px;
            }
            
            .memory-board {
                grid-template-columns: repeat(6, 1fr);
                grid-gap: 5px;
            }
            
            .card {
                height: 60px;
            }
            
            .game-info {
                padding: 8px;
                margin-bottom: 10px;
            }
            
            .progress-container {
                margin-bottom: 10px;
            }
            
            .status {
                margin-bottom: 10px;
            }
            
            .level-indicator {
                margin-bottom: 10px;
            }
        }

        /* For very large screens */
        @media (min-width: 1200px) {
            .container {
                max-width: 1000px;
            }
            
            .card {
                height: 120px;
            }
            
            .card-back {
                font-size: 3rem;
            }
        }

        /* Touch device optimizations */
        @media (hover: none) {
            .card:hover {
                transform: none;
                border-color: rgba(255, 255, 255, 0.3);
            }
            
            button:hover {
                transform: none;
                box-shadow: none;
                background-color: #1e3a8a;
            }
            
            button:active {
                transform: translateY(2px);
                background-color: #2563eb;
            }
        }
    </style>
</head>
<body>
    <div class="lantern">ğŸª”</div>
    <div class="lantern">ğŸª”</div>

    <div class="container">
        <div class="header">
            <h1>Ù„Ø¹Ø¨Ø© Ù…ÙŠÙ…ÙˆØ±ÙŠ Ù…Ø§ØªØ´ Ø±Ù…Ø¶Ø§Ù†ÙŠØ© <span class="ramadan-icon">ğŸŒ™</span><span class="ramadan-icon">âœ¨</span></h1>
        </div>

        <div class="level-indicator" id="level-indicator">
            <div class="level-dot active" data-level="1"></div>
            <div class="level-dot" data-level="2"></div>
            <div class="level-dot" data-level="3"></div>
        </div>

        <div class="game-info">
            <div class="info-item">
                <div class="info-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                <div class="info-value" id="level-display">1</div>
            </div>
            <div class="info-item">
                <div class="info-label">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                <div class="info-value" id="score-display">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">Ø§Ù„ÙˆÙ‚Øª</div>
                <div class="info-value" id="time-display">0</div>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="status" id="status">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</div>

        <div class="memory-board" id="memory-board">
            <!-- Cards will be generated dynamically -->
        </div>

        <div class="controls">
            <button id="restart-game">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>
    </div>

    <div class="level-complete" id="level-complete">
        <h2>Ø£Ø­Ø³Ù†Øª! <span class="ramadan-icon">ğŸ‰</span></h2>
        <p id="level-complete-message">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1!</p>
        <p id="level-complete-score">Ø§Ù„Ù†Ù‚Ø§Ø·: <span>0</span></p>
        <p id="level-complete-time">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span>0</span> Ø«Ø§Ù†ÙŠØ©</p>
        <button id="next-level-btn">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>

    <div class="game-start" id="game-start">
        <h2>Ù„Ø¹Ø¨Ø© Ù…ÙŠÙ…ÙˆØ±ÙŠ Ù…Ø§ØªØ´ Ø±Ù…Ø¶Ø§Ù†ÙŠØ© <span class="ramadan-icon">ğŸŒ™</span></h2>
        <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ©! Ø§Ø®ØªØ¨Ø± Ø°Ø§ÙƒØ±ØªÙƒ ÙÙŠ Ù…Ø±Ø§Ø­Ù„ Ù…ØªØ²Ø§ÙŠØ¯Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø©. ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© ØªØªØ·Ù„Ø¨ ØªØ±ÙƒÙŠØ²Ø§Ù‹ Ø£ÙƒØ¨Ø± ÙˆØ°Ø§ÙƒØ±Ø© Ø£Ù‚ÙˆÙ‰!</p>
        <div style="margin-bottom: 20px;">
            <p><span class="level-badge">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1</span> 4 Ø£Ø²ÙˆØ§Ø¬ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</p>
            <p><span class="level-badge">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2</span> 6 Ø£Ø²ÙˆØ§Ø¬ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</p>
            <p><span class="level-badge">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3</span> 8 Ø£Ø²ÙˆØ§Ø¬ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</p>
            <p><span class="level-badge">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠ</span> Ù…Ø³ØªÙˆÙŠØ§Øª Ù…ØªØ²Ø§ÙŠØ¯Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ø¨Ù„Ø§ Ù†Ù‡Ø§ÙŠØ©!</p>
        </div>
        <div class="start-buttons">
            <button id="start-game-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© (3 Ù…Ø³ØªÙˆÙŠØ§Øª)</button>
            <button id="start-infinite-btn">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠ</button>
        </div>
    </div>

    <div class="game-complete" id="game-complete">
        <h2>ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! <span class="ramadan-icon">ğŸ‰</span></h2>
        <p>Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­!</p>
        <p id="final-score">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·: <span>0</span></p>
        <div style="display: flex; gap: 15px;">
            <button id="play-again-btn">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
            <button id="try-infinite-btn">Ø¬Ø±Ø¨ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠ</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const memoryBoard = document.getElementById('memory-board');
            const status = document.getElementById('status');
            const restartGameBtn = document.getElementById('restart-game');
            const levelDisplay = document.getElementById('level-display');
            const scoreDisplay = document.getElementById('score-display');
            const timeDisplay = document.getElementById('time-display');
            const progressBar = document.getElementById('progress-bar');
            const levelComplete = document.getElementById('level-complete');
            const levelCompleteMessage = document.getElementById('level-complete-message');
            const levelCompleteScore = document.getElementById('level-complete-score').querySelector('span');
            const levelCompleteTime = document.getElementById('level-complete-time').querySelector('span');
            const nextLevelBtn = document.getElementById('next-level-btn');
            const levelIndicator = document.getElementById('level-indicator');
            const gameStart = document.getElementById('game-start');
            const startGameBtn = document.getElementById('start-game-btn');
            const startInfiniteBtn = document.getElementById('start-infinite-btn');
            const gameComplete = document.getElementById('game-complete');
            const finalScore = document.getElementById('final-score').querySelector('span');
            const playAgainBtn = document.getElementById('play-again-btn');
            const tryInfiniteBtn = document.getElementById('try-infinite-btn');

            // Game variables
            let currentLevel = 1;
            let score = 0;
            let timer = 0;
            let timerInterval = null;
            let flippedCards = [];
            let matchedPairs = 0;
            let totalPairs = 0;
            let gameActive = false;
            let canFlip = true;
            let levelScores = [0, 0, 0];
            let infiniteMode = false;

            // Ramadan-themed emojis for cards
            const cardSymbols = [
                'ğŸŒ™', 'ğŸ•Œ', 'ğŸª”', 'ğŸ“¿', 'ğŸœ', 'ğŸ§†', 'ğŸ¥˜', 'â˜ªï¸', 'ğŸŒŸ', 'ğŸ‡', 'ğŸ§‰', 'ğŸ•‹',
                'ğŸ½ï¸', 'ğŸ§¿', 'ğŸŒ´', 'ğŸ®', 'ğŸŒ¹', 'ğŸŠ', 'ğŸ¯', 'ğŸ§ƒ', 'ğŸ¥®', 'ğŸ¬', 'ğŸ¡', 'ğŸ¦'
            ];

            // Level configurations
            const levels = {
                1: {
                    pairs: 4,
                    columns: 4,
                    timeLimit: 30,
                    flipDelay: 1000 // Time in ms before unmatched cards flip back
                },
                2: {
                    pairs: 6,
                    columns: 4,
                    timeLimit: 45,
                    flipDelay: 800 // Faster flip back for level 2
                },
                3: {
                    pairs: 8,
                    columns: 4,
                    timeLimit: 60,
                    flipDelay: 600 // Even faster flip back for level 3
                }
            };

            // Function to get level config for any level (including infinite mode)
            function getLevelConfig(level) {
                if (level <= 3) {
                    return levels[level];
                } else {
                    // For levels beyond 3, increase difficulty
                    const baseTimePerPair = 7; // seconds per pair
                    const pairs = Math.min(12 + Math.floor((level - 3) / 2), 24); // Max 24 pairs
                    const columns = Math.min(6, Math.ceil(Math.sqrt(pairs * 2)));
                    const timeLimit = pairs * baseTimePerPair;
                    const flipDelay = Math.max(300, 600 - (level - 3) * 50); // Min 300ms delay
                    
                    return { pairs, columns, timeLimit, flipDelay };
                }
            }

            // Adjust grid columns based on screen size and orientation
            function adjustGridColumns() {
                const width = window.innerWidth;
                const height = window.innerHeight;
                const isLandscape = width > height;
                
                const config = getLevelConfig(currentLevel);
                let columns = config.columns;
                
                if (width <= 400) {
                    columns = Math.min(columns, 2);
                } else if (width <= 600) {
                    columns = Math.min(columns, 3);
                } else if (isLandscape && height <= 500) {
                    columns = Math.min(columns, 8);
                }
                
                // If game is active, update the board
                if (gameActive) {
                    memoryBoard.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
                }
            }

            // Update level dots
            function updateLevelDots(level) {
                // Clear existing dots
                levelIndicator.innerHTML = '';
                
                // For standard mode, show 3 dots
                if (!infiniteMode) {
                    for (let i = 1; i <= 3; i++) {
                        const dot = document.createElement('div');
                        dot.className = `level-dot ${i === level ? 'active' : ''}`;
                        dot.setAttribute('data-level', i);
                        levelIndicator.appendChild(dot);
                    }
                } else {
                    // For infinite mode, show dots based on current level
                    // Always show at least 3 dots
                    const dotsToShow = Math.max(3, level);
                    
                    for (let i = 1; i <= dotsToShow; i++) {
                        const dot = document.createElement('div');
                        dot.className = `level-dot ${i === level ? 'active' : ''}`;
                        dot.setAttribute('data-level', i);
                        levelIndicator.appendChild(dot);
                    }
                }
            }

            // Listen for resize events to adjust the grid
            window.addEventListener('resize', adjustGridColumns);
            
            // Initial adjustment
            adjustGridColumns();

            // Start game button event listeners
            startGameBtn.addEventListener('click', () => {
                gameStart.style.display = 'none';
                infiniteMode = false;
                initGame(currentLevel);
            });
            
            startInfiniteBtn.addEventListener('click', () => {
                gameStart.style.display = 'none';
                infiniteMode = true;
                initGame(currentLevel);
            });

            // Try infinite mode button
            tryInfiniteBtn.addEventListener('click', () => {
                gameComplete.classList.remove('show');
                infiniteMode = true;
                currentLevel = 1;
                score = 0;
                scoreDisplay.textContent = score;
                levelScores = [0, 0, 0];
                initGame(currentLevel);
            });

            // Initialize game with specific level
            function initGame(level) {
                // Reset game variables
                flippedCards = [];
                matchedPairs = 0;
                gameActive = true;
                canFlip = true;
                
                // Update level display
                levelDisplay.textContent = level;
                updateLevelDots(level);
                
                // Set total pairs based on level
                const config = getLevelConfig(level);
                totalPairs = config.pairs;
                
                // Reset timer
                clearInterval(timerInterval);
                timer = config.timeLimit;
                timeDisplay.textContent = timer;
                
                // Reset progress bar
                progressBar.style.width = '0%';
                
                // Create shuffled cards
                const cards = createShuffledCards(level);
                
                // Create the memory board
                createMemoryBoard(cards, level);
                
                // Start timer
                startTimer();
                
                // Update status
                status.textContent = 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª';
            }

            // Create shuffled cards for a specific level
            function createShuffledCards(level) {
                // Get number of pairs for this level
                const config = getLevelConfig(level);
                const pairsCount = config.pairs;
                
                // Create pairs of cards
                let cards = [];
                for (let i = 0; i < pairsCount; i++) {
                    const symbol = cardSymbols[i % cardSymbols.length];
                    cards.push({ symbol, matched: false });
                    cards.push({ symbol, matched: false });
                }
                
                // Shuffle cards
                for (let i = cards.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [cards[i], cards[j]] = [cards[j], cards[i]];
                }
                
                return cards;
            }

            // Create the memory board
            function createMemoryBoard(cards, level) {
                memoryBoard.innerHTML = '';
                
                // Set grid columns based on level and screen size
                const config = getLevelConfig(level);
                memoryBoard.style.gridTemplateColumns = `repeat(${config.columns}, 1fr)`;
                
                cards.forEach((card, index) => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'card';
                    cardElement.setAttribute('data-index', index);
                    
                    // Create card inner structure
                    cardElement.innerHTML = `
                        <div class="card-inner">
                            <div class="card-front">?</div>
                            <div class="card-back">${card.symbol}</div>
                        </div>
                    `;
                    
                    // Add click event listener
                    cardElement.addEventListener('click', cardClicked);
                    
                    memoryBoard.appendChild(cardElement);
                });
            }

            // Handle card click
            function cardClicked(e) {
                if (!gameActive || !canFlip) return;
                
                const cardElement = e.currentTarget;
                const index = parseInt(cardElement.getAttribute('data-index'));
                
                // Check if card is already matched or flipped
                if (cardElement.classList.contains('matched') || cardElement.classList.contains('flipped')) {
                    return;
                }
                
                // Check if already flipped two cards
                if (flippedCards.length >= 2) {
                    return;
                }
                
                // Flip the card
                cardElement.classList.add('flipped');
                flippedCards.push({ index, element: cardElement });
                
                // If this is the second card flipped, check for match
                if (flippedCards.length === 2) {
                    canFlip = false;
                    
                    const firstCardIndex = flippedCards[0].index;
                    const secondCardIndex = flippedCards[1].index;
                    const firstCardElement = flippedCards[0].element;
                    const secondCardElement = flippedCards[1].element;
                    
                    const firstCardSymbol = firstCardElement.querySelector('.card-back').textContent;
                    const secondCardSymbol = secondCardElement.querySelector('.card-back').textContent;
                    
                    if (firstCardSymbol === secondCardSymbol) {
                        // Match found
                        setTimeout(() => {
                            firstCardElement.classList.add('matched');
                            secondCardElement.classList.add('matched');
                            
                            // Update score - more points for higher levels and faster matches
                            const levelBonus = currentLevel * 10;
                            const timeBonus = Math.floor(timer / 5);
                            const matchPoints = levelBonus + timeBonus;
                            
                            score += matchPoints;
                            scoreDisplay.textContent = score;
                            
                            // Update matched pairs
                            matchedPairs++;
                            
                            // Update progress bar
                            const progress = (matchedPairs / totalPairs) * 100;
                            progressBar.style.width = `${progress}%`;
                            
                            // Check for level complete
                            if (matchedPairs === totalPairs) {
                                clearInterval(timerInterval);
                                
                                // Store level score
                                if (currentLevel <= 3) {
                                    levelScores[currentLevel - 1] = score - levelScores.slice(0, currentLevel - 1).reduce((a, b) => a + b, 0);
                                }
                                
                                // Show level complete screen
                                if (infiniteMode) {
                                    levelCompleteMessage.textContent = `Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel}!`;
                                } else {
                                    levelCompleteMessage.textContent = `Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel} Ù…Ù† 3!`;
                                }
                                levelCompleteScore.textContent = score;
                                levelCompleteTime.textContent = timer;
                                
                                // Add a small delay before showing the level complete screen
                                setTimeout(() => {
                                    levelComplete.classList.add('show');
                                    createConfetti();
                                }, 500);
                            }
                            
                            // Reset flipped cards
                            flippedCards = [];
                            canFlip = true;
                        }, 500);
                    } else {
                        // No match
                        setTimeout(() => {
                            firstCardElement.classList.remove('flipped');
                            secondCardElement.classList.remove('flipped');
                            
                            // Reset flipped cards
                            flippedCards = [];
                            canFlip = true;
                        }, getLevelConfig(currentLevel).flipDelay); // Use level-specific flip delay
                    }
                }
            }

            // Start timer
            function startTimer() {
                clearInterval(timerInterval);
                const config = getLevelConfig(currentLevel);
                timer = config.timeLimit;
                timeDisplay.textContent = timer;
                
                timerInterval = setInterval(() => {
                    timer--;
                    timeDisplay.textContent = timer;
                    
                    if (timer <= 0) {
                        clearInterval(timerInterval);
                        gameActive = false;
                        status.textContent = 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                    }
                }, 1000);
            }

            // Next level button
            nextLevelBtn.addEventListener('click', () => {
                levelComplete.classList.remove('show');
                
                if (!infiniteMode && currentLevel >= 3) {
                    // Game completed (non-infinite mode)
                    finalScore.textContent = score;
                    gameComplete.classList.add('show');
                    createConfetti();
                } else {
                    // Next level
                    currentLevel++;
                    initGame(currentLevel);
                }
            });

            // Play again button
            playAgainBtn.addEventListener('click', () => {
                gameComplete.classList.remove('show');
                currentLevel = 1;
                score = 0;
                scoreDisplay.textContent = score;
                levelScores = [0, 0, 0];
                initGame(currentLevel);
            });

            // Restart game button
            restartGameBtn.addEventListener('click', () => {
                initGame(currentLevel);
            });

            // Create confetti effect
            function createConfetti() {
                const colors = ['#ffffff', '#2563eb', '#1e3a8a', '#60a5fa', '#93c5fd'];
                
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-10px';
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    
                    document.body.appendChild(confetti);
                    
                    const animation = confetti.animate(
                        [
                            { transform: 'translate(0, 0) rotate(0deg)', opacity: 1 },
                            { transform: `translate(${Math.random() * 100 - 50}px, ${Math.random() * 500 + 500}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                        ],
                        {
                            duration: Math.random() * 3000 + 2000,
                            easing: 'cubic-bezier(0.1, 0.8, 0.3, 1)'
                        }
                    );
                    
                    animation.onfinish = () => {
                        confetti.remove();
                    };
                }
            }
            
            // Handle touch events better for mobile devices
            if ('ontouchstart' in window) {
                document.querySelectorAll('button').forEach(button => {
                    button.addEventListener('touchstart', function() {
                        this.style.transform = 'scale(0.95)';
                    });
                    
                    button.addEventListener('touchend', function() {
                        this.style.transform = 'scale(1)';
                    });
                });
            }
            
            // Add share functionality
            function shareGame() {
                if (navigator.share) {
                    navigator.share({
                        title: 'Ù„Ø¹Ø¨Ø© Ù…ÙŠÙ…ÙˆØ±ÙŠ Ù…Ø§ØªØ´ Ø±Ù…Ø¶Ø§Ù†ÙŠØ©',
                        text: 'Ø¬Ø±Ø¨Øª Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ© Ø§Ù„Ø±Ø§Ø¦Ø¹Ø©! ØªØ¹Ø§Ù„ ÙˆØ§Ù„Ø¹Ø¨ Ù…Ø¹ÙŠ!',
                        url: window.location.href
                    })
                    .catch(error => console.log('Error sharing:', error));
                }
            }
            
            // Add share button if sharing is supported
            if (navigator.share) {
                const shareBtn = document.createElement('button');
                shareBtn.textContent = 'Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù„Ø¹Ø¨Ø©';
                shareBtn.style.marginLeft = '10px';
                shareBtn.addEventListener('click', shareGame);
                
                document.querySelector('.controls').appendChild(shareBtn);
            }
            
            // Add fullscreen support
            function toggleFullScreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`Error attempting to enable full-screen mode: ${err.message}`);
                    });
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            }
            
            // Add fullscreen button
            const fullscreenBtn = document.createElement('button');
            fullscreenBtn.textContent = 'Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©';
            fullscreenBtn.style.marginLeft = '10px';
            fullscreenBtn.addEventListener('click', toggleFullScreen);
            
            document.querySelector('.controls').appendChild(fullscreenBtn);
            
            // Prevent zooming on double tap for touch devices
            document.addEventListener('touchstart', function(event) {
                if (event.touches.length > 1) {
                    event.preventDefault();
                }
            }, { passive: false });
            
            // Prevent pinch zoom
            document.addEventListener('gesturestart', function(event) {
                event.preventDefault();
            });
        });
    </script>
</body>
</html>